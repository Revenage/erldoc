{"summary":"Convenience functions for microstate accounting","description":"<p> </p><p>This module implements some convenience functions for analyzing microstate accounting data. For details about how to use the basic api and what the different states represent see <span class=\"bold_code bc-13\"><a href=\"/erldoc/docs/erlang#statistics_microstate_accounting\"><span class=\"code\">erlang:statistics(microstate_accounting)</span></a></span>.</p> <a name=\"msacc_print_example\"></a> <p><strong>Basic Scenario</strong></p> <div class=\"example\"><pre>1&gt; <span class=\"bold_code bc-12\">msacc:start(1000).</span>ok2&gt; <span class=\"bold_code bc-12\">msacc:print().</span>Average thread real-time : 1000513 usAccumulated system run-time : 2213 usAverage scheduler run-time : 1076 us Thread aux check_io emulator gc other port sleep Stats per thread: async( 0) 0.00% 0.00% 0.00% 0.00% 0.00% 0.00% 100.00% async( 1) 0.00% 0.00% 0.00% 0.00% 0.00% 0.00% 100.00% aux( 1) 0.00% 0.00% 0.00% 0.00% 0.00% 0.00% 99.99% scheduler( 1) 0.00% 0.03% 0.13% 0.00% 0.01% 0.00% 99.82% scheduler( 2) 0.00% 0.00% 0.00% 0.00% 0.03% 0.00% 99.97% Stats per type: async 0.00% 0.00% 0.00% 0.00% 0.00% 0.00% 100.00% aux 0.00% 0.00% 0.00% 0.00% 0.00% 0.00% 99.99% scheduler 0.00% 0.02% 0.06% 0.00% 0.02% 0.00% 99.89%ok</pre></div> <p>This first command enables microstate accounting for 1000 milliseconds. See <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#start-0\"><span class=\"code\">start/0</span></a></span>, <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#stop-0\"><span class=\"code\">stop/0</span></a></span>, <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#reset-0\"><span class=\"code\">reset/0</span></a></span> and <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#start-1\"><span class=\"code\">start/1</span></a></span> for more details. The second command prints the statistics gathered during that time. First three general statistics are printed.</p> <dl> <dt><strong>Average real-time</strong></dt> <dd>The average time spent collecting data in the threads. This should be close to the time which data was collected. </dd> <dt><strong>System run-time</strong></dt> <dd>The total run-time of all threads in the system. This is what you get if you call <span class=\"code\">msacc:stats(total_runtime,Stats).</span> </dd> <dt><strong>Average scheduler run-time</strong></dt> <dd>The average run-time for the schedulers. This is the average amount of time the schedulers did not sleep.</dd> </dl> <p>Then one column per state is printed with a the percentage of time this thread spent in the state out of it&apos;s own real-time. After the thread specific time, the accumulated time for each type of thread is printed in a similar format.</p> <p>Since we have the average real-time and the percentage spent in each state we can easily calculate the time spent in each state by multiplying <span class=\"code\">Average thread real-time</span> with <span class=\"code\">Thread state %</span>, i.e. to get the time Scheduler 1 spent in the emulator state we do <span class=\"code\">1000513us * 0.13% = 1300us</span>.</p> <p></p>","funcs":" <a name=\"available-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-available-0-id90380\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L148\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>available() -&gt; boolean()</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY rb-7\"><p> </p><p>This function checks whether microstate accounting is available or not.</p> <p></p></div> <a name=\"start-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-start-0-id90445\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L156\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>start() -&gt; boolean()</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY rb-7\"><p> </p><p>Start microstate accounting. Returns whether it was previously enabled or disabled.</p> <p></p></div> <a name=\"start-1\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-start-1-id90506\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L164\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>start(Time) -&gt; true</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Time = timeout()</span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Resets all counters and then starts microstate accounting for the given milliseconds.</p> <p></p></div> <a name=\"stop-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-stop-0-id90508\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L172\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>stop() -&gt; boolean()</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY rb-7\"><p> </p><p>Stop microstate accounting. Returns whether is was previously enabled or disabled.</p> <p></p></div> <a name=\"reset-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-reset-0-id90643\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L180\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>reset() -&gt; boolean()</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY rb-7\"><p> </p><p>Reset microstate accounting counters. Returns whether is was enabled or disabled.</p> <p></p></div> <a name=\"print-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-print-0-id90702\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L188\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>print() -&gt; ok</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY rb-7\"><p> </p><p> Prints the current microstate accounting to standard out. Same as <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#print-1\"><span class=\"code\">msacc:print(msacc:stats(),#{}).</span></a></span> </p> <p></p></div> <a name=\"print-1\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-print-1-id90772\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L201\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>print(DataOrStats) -&gt; ok</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">DataOrStats = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span> | <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_stats\">msacc_stats()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Print the given microstate statistics values to stdout. Same as <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#print-1\"><span class=\"code\">msacc:print(DataOrStats,#{}).</span></a></span> </p> <p></p></div> <a name=\"print-2\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-print-2-id90886\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L213\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>print(DataOrStats, Options) -&gt; ok</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">DataOrStats = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span> | <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_stats\">msacc_stats()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Options = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_print_options\">msacc_print_options()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Print the given microstate statistics values to standard out. With many states this can be quite verbose. See the top of this reference manual for a brief description of what the fields mean.</p> <p>It is possible to print more specific types of statistics by first manipulating the <span class=\"code\">DataOrStats</span> using <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#stats-2\"><span class=\"code\">stats/2</span></a></span>. For instance if you want to print the percentage of run-time for each thread you can do:</p> <div class=\"example\"><pre><span class=\"bold_code bc-12\">msacc:print(msacc:stats(runtime,msacc:stats())).</span></pre></div> <p>If you want to only print run-time per thread type you can do:</p> <div class=\"example\"><pre><span class=\"bold_code bc-12\">msacc:print(msacc:stats(type,msacc:stats(runtime,msacc:stats()))).</span></pre></div> <p><strong>Options</strong></p> <dl> <dt><strong><span class=\"code\">system</span></strong></dt><dd>Print percentage of time spent in each state out of system time as well as thread time. Default: false.</dd> </dl> <p></p></div> <a name=\"print-3\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-print-3-id91067\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L236\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>print(FileOrDevice, DataOrStats, Options) -&gt; ok</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">FileOrDevice = <span class=\"bold_code bc-14\"><a href=\"/erldoc/docs/file#type-filename\">file:filename()</a></span> | <span class=\"bold_code bc-14\"><a href=\"/erldoc/docs/io#type-device\">io:device()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">DataOrStats = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span> | <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_stats\">msacc_stats()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Options = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_print_options\">msacc_print_options()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Print the given microstate statistics values to the given file or device. The other arguments behave the same way as for <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#print-2\"><span class=\"code\">print/2</span></a></span>.</p> <p></p></div> <a name=\"stats-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-stats-0-id91092\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L245\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>stats() -&gt; <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span></div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY rb-7\"><p> </p><p>Returns a runtime system independent version of the microstate statistics data presented by <span class=\"bold_code bc-13\"><a href=\"/erldoc/docs/erlang#statistics_microstate_accounting\"><span class=\"code\">erlang:statistics(microstate_accounting)</span></a></span>. All counters have been normalized to be in microsecond resolution.</p> <p></p></div> <a name=\"stats-2\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-stats-2-id91310\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L256\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>stats(Analysis, Stats) -&gt; integer() &gt;= 0</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Analysis = system_realtime | system_runtime</span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Stats = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Returns the system time for the given microstate statistics values. System time is the accumulated time of all threads.</p> <dl> <dt><strong><span class=\"code\">realtime</span></strong></dt> <dd>Returns all time recorded for all threads.</dd> <dt><strong><span class=\"code\">runtime</span></strong></dt> <dd>Returns all time spent doing work for all threads, i.e. all time not spent in the <span class=\"code\">sleep</span> state.</dd> </dl> <p></p></div> <table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-stats-2-id91449\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L271\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>stats(Analysis, Stats) -&gt; <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_stats\">msacc_stats()</a></span></div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Analysis = realtime | runtime</span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Stats = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Returns fractions of real-time or run-time spent in the various threads from the given microstate statistics values.</p> <p></p></div> <table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-stats-2-id91450\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L279\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>stats(Analysis, StatsOrData) -&gt; <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span> | <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_stats\">msacc_stats()</a></span></div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Analysis = type</span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">StatsOrData = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span> | <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_stats\">msacc_stats()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Returns a list of microstate statistics values where the values for all threads of the same type has been merged.</p> <p></p></div> <a name=\"to_file-1\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-to_file-1-id91589\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L287\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>to_file(Filename) -&gt; ok | {error, <span class=\"bold_code bc-14\"><a href=\"/erldoc/docs/file#type-posix\">file:posix()</a></span>}</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Filename = <span class=\"bold_code bc-14\"><a href=\"/erldoc/docs/file#type-name_all\">file:name_all()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Dumps the current microstate statistics counters to a file that can be parsed with <span class=\"bold_code bc-13\"><a href=\"/erldoc/docs/file#consult-1\">file:consult/1</a></span>.</p> <p></p></div> <a name=\"from_file-1\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-from_file-1-id91743\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/runtime_tools/doc/src/msacc.xml#L296\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>from_file(Filename) -&gt; <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-msacc_data\">msacc_data()</a></span></div></td><td class=\"func-since-td\"><span class=\"since\">OTP 19.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Filename = <span class=\"bold_code bc-14\"><a href=\"/erldoc/docs/file#type-name_all\">file:name_all()</a></span></span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Read a file dump produced by <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#to_file-1\">to_file(Filename)</a></span>.</p> <p></p></div> ","name":"msacc"}