{"summary":"Analysis and Utility Functions for Instrumentation","description":"<p> </p><p>The module <span class=\"code\">instrument</span> contains support for studying the resource usage in an Erlang runtime system. Currently, only the allocation of memory can be studied.</p> <div class=\"note\"><div class=\"label\">Note</div><div class=\"content\"><p> </p><p>Note that this whole module is experimental, and the representations used as well as the functionality is likely to change in the future.</p> <p></p></div></div> <p></p>","funcs":" <a name=\"allocations-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-allocations-0-id101780\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/tools/doc/src/instrument.xml#L94\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>allocations() -&gt; {ok, Result} | {error, Reason}</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 21.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Result = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-allocation_summary\">allocation_summary()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Reason = not_enabled</span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Shorthand for <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#allocations-1\"><span class=\"code\">allocations(#{})</span>.</a></span></p> <p></p></div> <a name=\"allocations-1\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-allocations-1-id101801\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/tools/doc/src/instrument.xml#L103\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>allocations(Options) -&gt; {ok, Result} | {error, Reason}</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 21.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Result = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-allocation_summary\">allocation_summary()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Reason = not_enabled</span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Options = <br>&#xA0;&#xA0;&#xA0;&#xA0;#{scheduler_ids =&gt; [integer() &gt;= 0],<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;allocator_types =&gt; [atom()],<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;histogram_start =&gt; integer() &gt;= 1,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;histogram_width =&gt; integer() &gt;= 1}</span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Returns a summary of all tagged allocations in the system, optionally filtered by allocator type and scheduler id.</p> <p>Only binaries and allocations made by NIFs and drivers are tagged by default, but this can be configured an a per-allocator basis with the <span class=\"bold_code bc-13\"><a href=\"/erldoc/docs/erts_alloc#M_atags\"><span class=\"code\">+M&lt;S&gt;atags</span></a></span> emulator option.</p> <p>If the specified allocator types are not enabled, the call will fail with <span class=\"code\">{error, not_enabled}</span>.</p> <p>The following options can be used:</p> <dl> <dt><strong><span class=\"code\">allocator_types</span></strong></dt> <dd> <p>The allocator types that will be searched. Note that blocks can move freely between allocator types, so restricting the search to certain allocators may return unexpected types (e.g. process heaps when searching binary_alloc), or hide blocks that were migrated out.</p> <p>Defaults to all <span class=\"code\">alloc_util</span> allocators.</p> </dd> <dt><strong><span class=\"code\">scheduler_ids</span></strong></dt> <dd> <p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p> </dd> <dt><strong><span class=\"code\">histogram_start</span></strong></dt> <dd> <p>The upper bound of the first interval in the allocated block size histograms. Defaults to 128.</p> </dd> <dt><strong><span class=\"code\">histogram_width</span></strong></dt> <dd> <p>The number of intervals in the allocated block size histograms. Defaults to 18.</p> </dd> </dl> <p><strong>Example:</strong></p> <div class=\"example example-none\"><pre>&gt; instrument:allocations(#{ histogram_start =&gt; 128, histogram_width =&gt; 15 }).{ok,{128,0, #{udp_inet =&gt; #{driver_event_state =&gt; {0,0,0,0,0,0,0,0,0,1,0,0,0,0,0}}, system =&gt; #{heap =&gt; {0,0,0,0,20,4,2,2,2,3,0,1,0,0,1}, db_term =&gt; {271,3,1,52,80,1,0,0,0,0,0,0,0,0,0}, code =&gt; {0,0,0,5,3,6,11,22,19,20,10,2,1,0,0}, binary =&gt; {18,0,0,0,7,0,0,1,0,0,0,0,0,0,0}, message =&gt; {0,40,78,2,2,0,0,0,0,0,0,0,0,0,0}, ... } spawn_forker =&gt; #{driver_select_data_state =&gt; {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0}}, ram_file_drv =&gt; #{drv_binary =&gt; {0,0,0,0,0,0,1,0,0,0,0,0,0,0,0}}, prim_file =&gt; #{process_specific_data =&gt; {2,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, nif_trap_export_entry =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}, monitor_extended =&gt; {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0}, drv_binary =&gt; {0,0,0,0,0,0,1,0,3,5,0,0,0,1,0}, binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}}, prim_buffer =&gt; #{nif_internal =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}, binary =&gt; {0,4,0,0,0,0,0,0,0,0,0,0,0,0,0}}}}}</pre></div> <p></p></div> <a name=\"carriers-0\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-carriers-0-id104580\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/tools/doc/src/instrument.xml#L175\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>carriers() -&gt; {ok, Result} | {error, Reason}</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 21.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Result = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-carrier_info_list\">carrier_info_list()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Reason = not_enabled</span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Shorthand for <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#carriers-1\"><span class=\"code\">carriers(#{})</span>.</a></span></p> <p></p></div> <a name=\"carriers-1\"></a><table class=\"func-table\"><tbody><tr class=\"func-tr\"><td class=\"func-td\"><div class=\"bold_code func-head\" ><span id=\"ghlink-carriers-1-id104545\" class=\"ghlink\"><a href=\"/erldoc/docs/https://github.com/erlang/otp/edit/maint/lib/tools/doc/src/instrument.xml#L184\" title=\"Found an issue with the documentation? Fix it by clicking here!\"><span class=\"pencil\"></span></a></span>carriers(Options) -&gt; {ok, Result} | {error, Reason}</div></td><td class=\"func-since-td\"><span class=\"since\">OTP 21.0</span></td></tr></tbody></table><div class=\"REFBODY fun-types\"><h3 class=\"func-types-title\">Types</h3><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Result = <span class=\"bold_code bc-17\"><a href=\"/erldoc/docs/#type-carrier_info_list\">carrier_info_list()</a></span></span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Reason = not_enabled</span></div><div class=\"REFTYPES rt-1\"><span class=\"bold_code bc-2\">Options = <br>&#xA0;&#xA0;&#xA0;&#xA0;#{scheduler_ids =&gt; [integer() &gt;= 0],<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;allocator_types =&gt; [atom()],<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;histogram_start =&gt; integer() &gt;= 1,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;histogram_width =&gt; integer() &gt;= 1}</span></div></div><div class=\"REFBODY rb-7\"><p> </p><p>Returns a summary of all carriers in the system, optionally filtered by allocator type and scheduler id.</p> <p>If the specified allocator types are not enabled, the call will fail with <span class=\"code\">{error, not_enabled}</span>.</p> <p>The following options can be used:</p> <dl> <dt><strong><span class=\"code\">allocator_types</span></strong></dt> <dd> <p>The allocator types that will be searched. Defaults to all <span class=\"code\">alloc_util</span> allocators.</p> </dd> <dt><strong><span class=\"code\">scheduler_ids</span></strong></dt> <dd> <p>The scheduler ids whose allocator instances will be searched. A scheduler id of 0 will refer to the global instance that is not tied to any particular scheduler. Defaults to all schedulers and the global instance.</p> </dd> <dt><strong><span class=\"code\">histogram_start</span></strong></dt> <dd> <p>The upper bound of the first interval in the free block size histograms. Defaults to 512.</p> </dd> <dt><strong><span class=\"code\">histogram_width</span></strong></dt> <dd> <p>The number of intervals in the free block size histograms. Defaults to 14.</p> </dd> </dl> <p><strong>Example:</strong></p> <div class=\"example example-none\"><pre>&gt; instrument:carriers(#{ histogram_start =&gt; 512, histogram_width =&gt; 8 }).{ok,{512, [{ll_alloc,1048576,0,1048344,71,false,{0,0,0,0,0,0,0,0}}, {binary_alloc,1048576,0,324640,13,false,{3,0,0,1,0,0,0,2}}, {eheap_alloc,2097152,0,1037200,45,false,{2,1,1,3,4,3,2,2}}, {fix_alloc,32768,0,29544,82,false,{22,0,0,0,0,0,0,0}}, {...}|...]}}</pre></div> <p></p></div> "}